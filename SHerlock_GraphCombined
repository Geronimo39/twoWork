def graph_combined(df, title="Kombinierter Graph (Programme + Files + Devices)"):
    import networkx as nx
    import matplotlib.pyplot as plt

    if df.empty:
        print("DataFrame ist leer – kein Graph erzeugt.")
        return

    G = nx.DiGraph()

    # Farben für Usage
    usage_colors = {
        "INPUT": "blue",
        "OUTPUT": "red",
        "UPDATE": "orange",
        "DELETE": "purple",
        "INPUT_UPDATE": "green",
        "INPUT_DELETE": "brown",
        "OUTPUT_UPDATE": "pink",
        "OPEN": "gray",
        "CLOSE": "black",
        "UNKNOWN": "lightgray"
    }

    # Knoten & Kanten einfügen
    for _, row in df.iterrows():
        caller = row["caller_pgm"]
        target = row["target_obj"]
        objtype = row["target_objtype"]
        usage = row["usage"]

        G.add_node(caller, type="PROGRAM")
        G.add_node(target, type=objtype)

        G.add_edge(caller, target, usage=usage)

    pos = nx.spring_layout(G, k=1.0, iterations=70)

    plt.figure(figsize=(18, 14))

    # Knoten nach Typ gruppieren
    program_nodes = [n for n, d in G.nodes(data=True) if d["type"] == "PROGRAM"]
    file_nodes = [n for n, d in G.nodes(data=True) if d["type"] == "FILE"]
    device_nodes = [n for n, d in G.nodes(data=True) if d["type"] == "DEVICE"]
    other_nodes = [n for n, d in G.nodes(data=True)
                   if d["type"] not in ("PROGRAM", "FILE", "DEVICE")]

    # Programme = Rechtecke
    nx.draw_networkx_nodes(G, pos, nodelist=program_nodes, node_shape="s",
                           node_color="#4C72B0", node_size=1600)

    # Files = Kreise
    nx.draw_networkx_nodes(G, pos, nodelist=file_nodes, node_shape="o",
                           node_color="#55A868", node_size=1600)

    # Devices = Dreiecke
    nx.draw_networkx_nodes(G, pos, nodelist=device_nodes, node_shape="^",
                           node_color="#F1C40F", node_size=1600)

    # Andere Objekte (falls vorhanden)
    nx.draw_networkx_nodes(G, pos, nodelist=other_nodes, node_shape="d",
                           node_color="#C44E52", node_size=1600)

    # Kantenfarben nach Usage
    edge_colors = [usage_colors.get(G[u][v]["usage"], "black") for u, v in G.edges()]
    nx.draw_networkx_edges(G, pos, edge_color=edge_colors, arrows=True, arrowsize=14)

    nx.draw_networkx_labels(G, pos, font_size=9, font_weight="bold")

    plt.title(title)
    plt.show()
